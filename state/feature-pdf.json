{
  "id": "pdf",
  "name": "PDF Extraction & Generation",
  "status": "in_progress",
  "description": "PDF template filling, OCR-based extraction, bid schedule parsing, IDR report generation",
  "docs": {
    "overview": "docs/features/feature-pdf-overview.md",
    "architecture": "docs/features/feature-pdf-architecture.md",
    "prd": "prds/pdf-extraction-v2-prd-2.0.md"
  },
  "constraints_file": "architecture-decisions/pdf-v2-constraints.md",
  "constraints_summary": [
    "OCR-only routing (no hybrid native/OCR strategies)",
    "No V1 imports in V2 extraction code",
    "Binary routing: render -> preprocess -> OCR (no fallback to native)",
    "No legacy compatibility flags or toggles",
    "Header consolidation stage (4A.1) runs after provisional and final classification",
    "Relaxed/rescue priceContinuation gates require item-number semantic to prevent false-positive row merges",
    "Row parsing stack is V3-only (NumericInterpreter -> RowParserV3 -> FieldConfidenceScorer)",
    "Grid line removal runs before cell OCR (GridLineRemover in Stage 2B-ii.6) with per-page fallback when removal fails",
    "Low-confidence numeric-cell re-OCR fallback retries with PSM8 + numeric whitelist and replaces only when retry output contains digits",
    "Crop upscaling is DPI-target based (`kTargetDpi=600`) and uses effective DPI metadata per crop",
    "Crop OCR sourceDpi is derived from effective DPI when provided; invalid DPI metadata is sanitized before OCR",
    "Scorecard includes observability rows B1-B6 plus GridLineRemover/orphan coverage with hardened ratio thresholds",
    "Interpretation pattern classification uses centralized `InterpretationPatterns` sets for standard vs correction logic",
    "Math backsolve repairs unitPrice from bidAmount/quantity when OCR corrupts price and backsolve is exact within $0.02",
    "Zero-conf sentinel replaces 0.0 OCR confidence with 0.50 neutral prior when cell has valid parsed text",
    "M&P enrichment path is independent from extraction pipeline and uses per-page quality-gated native-first text with OCR fallback",
    "M&P parser uses metadata-driven two-point anchor: regex `Item\\s+(\\d+)\\.` + bid item number whitelist. Case-sensitive, period-required."
  ],
  "integration": {
    "depends_on": [
      "photos",
      "sync"
    ],
    "required_by": [
      "entries",
      "toolbox"
    ]
  },
  "metrics": {
    "test_coverage_percentage": 87,
    "last_updated": "2026-02-21T23:59:59Z",
    "item_match_rate": 1.0,
    "quality_score": 0.993,
    "median_ocr_confidence": 0.95,
    "upscaling_coverage": 1.0,
    "gt_item_matches": "131/131 parsed-item matches under strict scorecard tracing",
    "items_extracted": 131,
    "items_processed": 131,
    "items_with_price": 131,
    "items_with_amount": 131,
    "bogus_items": 0,
    "computed_total": 7882926.73,
    "expected_total": 7882926.73,
    "null_unit_price_count": 0,
    "null_bid_amount_count": 0,
    "pipe_artifact_count": 0,
    "notes": "Session 422: Executed PDF pipeline refactor plan with major stage decompositions, synthetic region/OCR extractor extractions, and fixture wiring updates. PDF feature test scope is green; follow-up targeted unit-test hardening remains."
  },
  "current_phase": {
    "phase_name": "PDF Pipeline Refactor Plan (2026-02-20)",
    "status": "Implemented; stabilization/hardening in progress.",
    "plan_file": "plans/2026-02-20-pdf-pipeline-refactor-plan.md",
    "brainstorming_file": "plans/completed/2026-02-17-header-consolidation-stage.md",
    "escalation_path": "1) Regenerate fixtures with valid SPRINGFIELD_PDF define 2) Confirm item #100 reads $110.00 at cell OCR level 3) Confirm Stage 4E unit_price 131/131 pre-post-processing 4) Re-run extraction and stage trace suites until green",
    "diagnostic_fixtures": 28,
    "diagnostic_images": "1668 PNGs (rendered=6, preprocessed=6, stage diagnostics/crops)",
    "remaining_problems": [
      "Need validation of new scorecard thresholds and B-series coverage on non-Springfield PDFs",
      "Need monitoring to ensure LOW signals (B1/B2) remain stable quality indicators under fixture drift",
      "Need optional direct parseHocr-focused test coverage to reduce integration-only parser risk"
    ]
  }
}
