{
  "id": "pdf",
  "name": "PDF Extraction & Generation",
  "status": "in_progress",
  "description": "PDF template filling, OCR-based extraction, bid schedule parsing, IDR report generation",
  "docs": {
    "overview": "docs/features/feature-pdf-overview.md",
    "architecture": "docs/features/feature-pdf-architecture.md",
    "prd": "prds/pdf-extraction-v2-prd-2.0.md"
  },
  "constraints_file": "architecture-decisions/pdf-v2-constraints.md",
  "constraints_summary": [
    "OCR-only routing (no hybrid native/OCR strategies)",
    "No V1 imports in V2 extraction code",
    "Binary routing: render -> preprocess -> OCR (no fallback to native)",
    "No legacy compatibility flags or toggles",
    "Header consolidation stage (4A.1) runs after provisional and final classification",
    "Relaxed/rescue priceContinuation gates require item-number semantic to prevent false-positive row merges",
    "Row parsing stack is V3-only (NumericInterpreter -> RowParserV3 -> FieldConfidenceScorer)",
    "Width-driven dynamic insets must preserve crop interior safety bounds before OCR"
  ],
  "integration": {
    "depends_on": [
      "photos",
      "sync"
    ],
    "required_by": [
      "entries",
      "toolbox"
    ]
  },
  "metrics": {
    "test_coverage_percentage": 87,
    "last_updated": "2026-02-19T00:00:00Z",
    "item_match_rate": 0.931,
    "quality_score": 0.916,
    "median_ocr_confidence": 0.95,
    "upscaling_coverage": 1.0,
    "gt_item_matches": "122/131 parsed-item matches under strict scorecard tracing",
    "items_extracted": 126,
    "items_processed": 126,
    "items_with_price": 122,
    "items_with_amount": 122,
    "bogus_items": 4,
    "computed_total": 7502457.03,
    "expected_total": 7882926.73,
    "null_unit_price_count": 4,
    "null_bid_amount_count": 9,
    "pipe_artifact_count": 0,
    "notes": "Session 381: Drift correction removed and baseline inset formula corrected to ceil(w/2)+ceil(w*0.25)+1. Strict scorecard assertions are now enforced (131/131, 0 LOW/BUG targets) and currently fail at 48 OK / 5 LOW / 2 BUG with parsed=126 and with_amount=122."
  },
  "current_phase": {
    "phase_name": "Strict-Gate Recovery After Drift Fix",
    "status": "Core drift/inset fix is implemented and strict scorecard gates are enabled. Current outputs miss 131/131 + 0 LOW/BUG targets and require upstream recovery.",
    "plan_file": "plans/2026-02-19-drift-offset-fix-and-dynamic-inset.md",
    "brainstorming_file": "plans/completed/2026-02-17-header-consolidation-stage.md",
    "escalation_path": "1) Regenerate fixtures with valid SPRINGFIELD_PDF define 2) Recover upstream row/amount extraction to 131/131 3) Eliminate LOW/BUG rows under strict scorecard 4) Re-run extraction and stage trace suites until green",
    "diagnostic_fixtures": 27,
    "diagnostic_images": "1656 PNGs (rendered=6, preprocessed=6, stage diagnostics/crops)",
    "remaining_problems": [
      "Parsed items remain 126/131 under strict scorecard assertions",
      "Bid amount completeness remains 122/131 under strict scorecard assertions",
      "Scorecard remains 48 OK / 5 LOW / 2 BUG",
      "Fixture generation run skips without SPRINGFIELD_PDF dart-define"
    ]
  }
}
