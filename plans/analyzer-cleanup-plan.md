# Analyzer Cleanup Plan

**Created**: 2026-01-31
**Status**: READY FOR IMPLEMENTATION
**Total Issues**: 157 (7 errors, 67 warnings, 83 info)

## Overview

Comprehensive plan to resolve all 157 Flutter analyzer issues identified after Patrol v4 migration. Issues categorized by severity and grouped into 6 phases for efficient, risk-minimized cleanup.

## Issue Breakdown

| Category | Count | Severity |
|----------|-------|----------|
| **CRITICAL: test_bundle.dart** | 7 | ERROR |
| Unused/Duplicate Imports | 30 | Warning |
| Deprecated Flutter APIs | 10 | Info/Warning |
| use_build_context_synchronously | 15 | Info |
| Unused Fields/Variables | 15 | Warning |
| Missing @override | 18 | Info |
| await_only_futures | 19 | Info |
| unnecessary_null_comparison | 20 | Warning |
| Other (naming, style, dead code) | 23 | Info/Warning |

---

## Phase 1: CRITICAL - Fix test_bundle.dart (BLOCKING)

**Priority**: CRITICAL - MUST fix first
**Issues**: 7 errors
**Agent**: `qa-testing-agent`

### Summary

The `integration_test/test_bundle.dart` file has **7 hard errors** preventing test execution. This is from incomplete Patrol v4 migration in Session 234. The file uses deprecated `NativeAutomator` API and imports internal Patrol APIs.

### Root Cause

Session 234 migrated test files to Patrol v4's `$.platform` API, but the auto-generated `test_bundle.dart` was not updated. This file is re-generated by Patrol but has manual edits.

### Changes Required

**File**: `integration_test/test_bundle.dart`

| Line | Issue | Fix |
|------|-------|-----|
| 8 | ERROR: Import internal API | Remove `import 'package:patrol/src/native/contracts/contracts.dart';` |
| 62 | ERROR: NativeAutomator deprecated | Replace with `final platformAutomator = PlatformAutomator();` |
| 62-63 | ERROR: Missing platformAutomator arg | Pass `platformAutomator` to `PatrolBinding.ensureInitialized()` |
| 63 | ERROR: initialize() undefined | Remove `await nativeAutomator.initialize();` |
| 64 | ERROR: Wrong type for PatrolBinding | Change to `PatrolBinding.ensureInitialized(platformAutomator)` |
| 65 | ERROR: DartGroupEntry not a type | This error should resolve after fixing line 62-64 |
| 111 | ERROR: markPatrolAppServiceReady() undefined | Remove `await nativeAutomator.markPatrolAppServiceReady();` |

### Implementation Steps

1. **Remove internal API import** (line 8)
   ```dart
   // REMOVE:
   import 'package:patrol/src/native/contracts/contracts.dart';
   ```

2. **Replace NativeAutomator with PlatformAutomator** (lines 62-64)
   ```dart
   // OLD (BROKEN):
   final nativeAutomator = NativeAutomator(config: NativeAutomatorConfig());
   await nativeAutomator.initialize();
   final binding = PatrolBinding.ensureInitialized(NativeAutomatorConfig());

   // NEW (Patrol v4):
   final platformAutomator = PlatformAutomator();
   final binding = PatrolBinding.ensureInitialized(platformAutomator);
   ```

3. **Remove deprecated markPatrolAppServiceReady call** (line 111)
   ```dart
   // REMOVE:
   await nativeAutomator.markPatrolAppServiceReady();
   ```

4. **Update variable references**
   - Change all `nativeAutomator` references to `platformAutomator` (if any remain)

### Verification

```bash
pwsh -Command "flutter analyze integration_test/test_bundle.dart"
```

Expected: 0 errors (down from 7)

---

## Phase 2: Quick Wins - Unused/Duplicate Imports

**Priority**: HIGH
**Issues**: 30 warnings
**Agent**: `code-review-agent`
**Effort**: 15 minutes (bulk removal)

### Summary

Remove unused and duplicate imports across integration tests, lib/, and test/ directories.

### Changes Required

#### Integration Test Files (17 files)

| File | Lines | Action |
|------|-------|--------|
| `integration_test/patrol/e2e_tests/app_smoke_test.dart` | 4 | Remove `import 'package:construction_inspector/main.dart'` |
| `integration_test/patrol/e2e_tests/auth_flow_test.dart` | 4, 6 | Remove main.dart import and test_mode_config import |
| `integration_test/patrol/e2e_tests/calendar_view_test.dart` | 6 | Remove helpers import |
| `integration_test/patrol/e2e_tests/entry_lifecycle_test.dart` | 2 | Remove material.dart import |
| `integration_test/patrol/e2e_tests/photo_flow_test.dart` | 2 | Remove material.dart (unnecessary_import) |
| `integration_test/patrol/e2e_tests/toolbox_flow_test.dart` | 5 | Remove helpers import |
| `integration_test/patrol/e2e_tests/ui_button_coverage_test.dart` | 1 | Remove material.dart import |
| `integration_test/patrol/helpers/patrol_test_helpers.dart` | 6 | Remove supabase_flutter import |
| `integration_test/patrol/isolated/app_lifecycle_test.dart` | 5 | Remove helpers import |
| `integration_test/patrol/isolated/auth_validation_test.dart` | 5 | Remove helpers import |
| `integration_test/patrol/isolated/camera_permission_test.dart` | 2, 4 | Remove material.dart and helpers imports |
| `integration_test/patrol/isolated/entry_validation_test.dart` | 2, 5 | Remove material.dart and helpers imports |
| `integration_test/patrol/isolated/location_permission_test.dart` | 4 | Remove helpers import |
| `integration_test/patrol/isolated/navigation_edge_test.dart` | 5 | Remove helpers import |

#### Lib Files (7 files)

| File | Lines | Issue | Action |
|------|-------|-------|--------|
| `lib/features/pdf/presentation/screens/measurement_spec_preview_screen.dart` | 7 | Unused | Remove shared.dart import |
| `lib/features/quantities/presentation/screens/quantities_screen.dart` | 13 | Unnecessary | Remove widgets.dart import (covered by shared.dart) |
| `lib/features/settings/presentation/screens/settings_screen.dart` | 6, 10 | Duplicate & Unused | Remove duplicate import at line 6, remove theme_provider import at line 10 |
| `lib/features/settings/presentation/widgets/clear_cache_dialog.dart` | 6 | Duplicate | Remove duplicate import |
| `lib/features/settings/presentation/widgets/edit_inspector_dialog.dart` | 4 | Duplicate | Remove duplicate import |
| `lib/features/settings/presentation/widgets/sign_out_dialog.dart` | 6 | Duplicate | Remove duplicate import |
| `lib/features/settings/presentation/widgets/sync_section.dart` | 5 | Duplicate | Remove duplicate import |
| `lib/features/settings/presentation/widgets/theme_section.dart` | 3, 5 | Unused | Remove widgets.dart and app_theme.dart imports |

#### Test Files (2 files)

| File | Lines | Action |
|------|-------|--------|
| `test/features/toolbox/services/auto_fill_context_builder_test.dart` | 3 | Remove auto_fill_engine.dart import |
| `test/helpers/mocks/mock_services.dart` | 1 | Remove sync_status.dart import |

### Implementation Steps

1. Use bulk find-replace or multi-cursor editing
2. Run analyzer after each directory (integration_test/, lib/, test/)
3. Verify no new errors introduced

### Verification

```bash
pwsh -Command "flutter analyze"
```

Expected: 127 issues remaining (down from 157)

---

## Phase 3: Deprecated Flutter APIs

**Priority**: HIGH
**Issues**: 10 (info/warning)
**Agent**: `flutter-specialist-agent`

### Summary

Replace deprecated Flutter APIs with modern equivalents. Most are from Flutter 3.38+ deprecations.

### Changes Required

#### 3.1: WillPopScope → PopScope (1 file)

**File**: `lib/features/projects/presentation/screens/project_setup_screen.dart`

| Line | Current | Replacement |
|------|---------|-------------|
| 121-122 | `WillPopScope(onWillPop: _handleBackNavigation, ...)` | `PopScope(canPop: false, onPopInvokedWithResult: _handlePopInvoked, ...)` |

**Migration Pattern**:
```dart
// OLD:
return WillPopScope(
  onWillPop: _handleBackNavigation,  // returns Future<bool>
  child: Scaffold(...),
);

// NEW:
return PopScope(
  canPop: false,  // Prevents default back navigation
  onPopInvokedWithResult: (didPop, result) async {
    if (!didPop) {
      final shouldPop = await _handleBackNavigation();
      if (shouldPop && context.mounted) {
        Navigator.of(context).pop();
      }
    }
  },
  child: Scaffold(...),
);
```

**Note**: Keep existing `_handleBackNavigation()` logic, just change the wrapping widget.

#### 3.2: Radio groupValue/onChanged → RadioGroup (1 file)

**File**: `lib/features/toolbox/presentation/widgets/dynamic_form_field.dart`

| Lines | Current | Replacement |
|-------|---------|-------------|
| 107 | `groupValue: widget.controller.text.isEmpty ? null : widget.controller.text` | Move to RadioGroup wrapper |
| 110 | `onChanged: (value) { ... }` | Use RadioGroup's onChanged |

**Migration Pattern**:
```dart
// OLD:
RadioListTile<String>(
  groupValue: widget.controller.text.isEmpty ? null : widget.controller.text,
  onChanged: (value) { ... },
  ...
)

// NEW (Wrap all radio buttons in RadioGroup):
RadioGroup<String>(
  groupValue: widget.controller.text.isEmpty ? null : widget.controller.text,
  onChanged: (value) {
    if (value != null) {
      widget.controller.text = value;
      widget.onChanged();
    }
  },
  child: Column(
    children: options.map((option) {
      return RadioListTile<String>(
        value: option.toString(),
        toggleable: true,
        enabled: widget.isEditable && !isFieldReadOnly,
        contentPadding: EdgeInsets.zero,
        dense: true,
      );
    }).toList(),
  ),
)
```

**Impact**: Lines 101-121 need restructuring.

#### 3.3: FormField.value → initialValue (2 files)

**File 1**: `lib/features/toolbox/presentation/screens/gallery_screen.dart`
- Line 424: Change `value:` to `initialValue:`

**File 2**: `lib/features/toolbox/presentation/widgets/dynamic_form_field.dart`
- Line 139: Change `value:` in DropdownButtonFormField to `initialValue:`

**Pattern**:
```dart
// OLD:
DropdownButtonFormField<String>(
  value: widget.controller.text.isEmpty ? null : widget.controller.text,
  ...
)

// NEW:
DropdownButtonFormField<String>(
  initialValue: widget.controller.text.isEmpty ? null : widget.controller.text,
  ...
)
```

#### 3.4: Color.withOpacity → withValues (3 files)

**File 1**: `lib/features/toolbox/presentation/widgets/dynamic_form_field.dart`
- Line 302: Change to `.withValues(alpha: ...)`

**File 2**: `lib/features/toolbox/presentation/widgets/form_preview_tab.dart`
- Line 143: Change to `.withValues(alpha: ...)`
- Line 146: Change to `.withValues(alpha: ...)`

**Pattern**:
```dart
// OLD:
color.withOpacity(0.1)  // opacity 0.0-1.0

// NEW:
color.withValues(alpha: 0.1)  // alpha 0.0-1.0
```

**Note**: `alpha` parameter is same range as `opacity` (0.0-1.0).

### Implementation Steps

1. Fix WillPopScope first (most complex)
2. Fix Radio deprecations (medium complexity)
3. Bulk replace FormField.value → initialValue
4. Bulk replace withOpacity → withValues

### Verification

```bash
pwsh -Command "flutter analyze --no-fatal-infos | Select-String 'deprecated_member_use'"
```

Expected: 0 deprecated_member_use warnings in lib/

---

## Phase 4: Async Context Safety (use_build_context_synchronously)

**Priority**: MEDIUM
**Issues**: 15 info
**Agent**: `flutter-specialist-agent`

### Summary

Add `mounted` checks before using `BuildContext` after async gaps. This is a code quality issue (not a runtime error unless widget is disposed during async operation).

### Pattern to Apply

```dart
// BEFORE:
await someAsyncOperation();
context.read<Provider>();  // Context may be invalid

// AFTER:
await someAsyncOperation();
if (!mounted) return;  // Safety check
context.read<Provider>();
```

### Changes Required

#### 4.1: entry_wizard_screen.dart (6 issues)

**File**: `lib/features/entries/presentation/screens/entry_wizard_screen.dart`

| Lines | Context | Fix Pattern |
|-------|---------|-------------|
| 2134, 2147, 2150, 2167 | After `await _saveEntry()` in button handlers | Already has `if (!mounted) return;` but **analyzer sees `this.mounted` not `context.mounted`** - Add `context.mounted` check |
| 2257, 2259 | After `showDialog` in `_confirmCancel()` | Add `if (!mounted) return;` after dialog await |

**Example Fix** (lines 2134-2170):
```dart
// Current (line 2134 area):
await _saveEntry();
if (!mounted) return;  // Already has this
final provider = Provider.of<DailyEntryProvider>(context, listen: false);  // Analyzer still warns

// Fix - add context.mounted alongside this.mounted:
await _saveEntry();
if (!mounted || !context.mounted) return;  // Explicit context check
final provider = Provider.of<DailyEntryProvider>(context, listen: false);
```

**Example Fix** (lines 2257-2259):
```dart
// Current:
final shouldCancel = await showDialog<bool>(...);
final provider = Provider.of<DailyEntryProvider>(context, listen: false);  // Bad

// Fix:
final shouldCancel = await showDialog<bool>(...);
if (!mounted) return;  // Add check
final provider = Provider.of<DailyEntryProvider>(context, listen: false);
```

#### 4.2: home_screen.dart (3 issues)

**File**: `lib/features/entries/presentation/screens/home_screen.dart`

| Lines | Context | Fix |
|-------|---------|-----|
| 1866 | After `_loadData()` in initState | Move `context.read` check immediately after async (currently too far) |
| 1965-1966 | After `showDialog` in delete confirmation | Add `if (!mounted) return;` after dialog |

#### 4.3: pdf_service.dart (5 issues)

**File**: `lib/features/pdf/services/pdf_service.dart`

| Lines | Context | Fix |
|-------|---------|-----|
| 401, 412 | After PDF generation async operations | Add null check for context parameter |
| 520 | After file save operation | Add null check for context parameter |
| 635, 639 | After async file operations | Add null check for context parameter |

**Note**: This is a **service file**, not a widget, so no `mounted` property exists. Instead, add **null safety re-checks** after async gaps.

**Example Fix** (lines 401-412):
```dart
// Current:
Future<void> generatePdf(BuildContext? context) async {
  await someAsyncOp();
  if (context != null) {
    ScaffoldMessenger.of(context).showSnackBar(...);  // Context may be invalid
  }
}

// Fix:
Future<void> generatePdf(BuildContext? context) async {
  await someAsyncOp();
  if (context == null) return;  // Early exit
  if (!context.mounted) return;  // Re-check after async
  ScaffoldMessenger.of(context).showSnackBar(...);
}
```

#### 4.4: form_fill_screen.dart (3 issues)

**File**: `lib/features/toolbox/presentation/screens/form_fill_screen.dart`

| Lines | Context | Fix |
|-------|---------|-----|
| 154-155 | After `showDatePicker` | Add `if (!mounted) return;` (Session 197 supposedly fixed this?) |
| 166 | After another async dialog | Add `if (!mounted) return;` |

### Implementation Steps

1. **entry_wizard_screen.dart** - Add `context.mounted` checks alongside `this.mounted`
2. **home_screen.dart** - Move mounted checks closer to async gaps
3. **pdf_service.dart** - Add context null + mounted re-checks after async
4. **form_fill_screen.dart** - Verify Session 197 fix, add missing checks

### Verification

```bash
pwsh -Command "flutter analyze --no-fatal-infos | Select-String 'use_build_context_synchronously'"
```

Expected: 0 issues (down from 15)

---

## Phase 5: Code Cleanup - Unused Variables & Missing @override

**Priority**: MEDIUM
**Issues**: 33 (15 unused + 18 @override)
**Agent**: `code-review-agent`

### Summary

Remove unused variables and add missing `@override` annotations. All are simple deletions or single-line additions.

### 5.1: Unused Local Variables (10 issues)

#### Integration Tests

**File**: `integration_test/patrol/e2e_tests/toolbox_flow_test.dart`
- Lines 696-698: Remove `wetDensityField`, `moistureField`, `maxDensityField` (3 unused finders)

**File**: `integration_test/patrol/isolated/app_lifecycle_test.dart`
- Line 192: Remove `hasHomeScreen` variable

**File**: `test/features/toolbox/presentation/screens/forms_list_screen_test.dart`
- Lines 269-271: Remove `allForms`, `builtinForms`, `projectForms` (3 unused variables)

**File**: `test/services/sync_service_test.dart`
- Line 261: Remove `result1` OR use it in assertion (check test logic)

#### Lib Files

**File**: `lib/features/toolbox/presentation/widgets/form_preview_tab.dart`
- Line 41: Remove `_pendingRefresh` field (never read)

**File**: `lib/services/sync_service.dart`
- Lines 131-133: Remove 3 unused remote datasource fields:
  - `_formFieldRegistryRemote`
  - `_fieldSemanticAliasRemote`
  - `_formFieldCacheRemote`

### 5.2: Dead Code (1 issue)

**File**: `integration_test/patrol/helpers/patrol_test_helpers.dart`
- Line 1091: Remove code after `return` statement (unreachable)

### 5.3: Missing @override Annotations (18 issues)

Add `@override` annotation above each method listed below.

#### Equipment Repository

**File**: `lib/features/contractors/data/repositories/equipment_repository.dart`
- Line 135: Add `@override` above `getCount()`
- Line 140: Add `@override` above `getPaged()`

#### Personnel Type Repository

**File**: `lib/features/contractors/data/repositories/personnel_type_repository.dart`
- Line 115: Add `@override` above `getCountByProject()`
- Line 145: Add `@override` above `getCount()`
- Line 150: Add `@override` above `getPaged()`
- Line 161: Add `@override` above `getByProjectIdPaged()`

#### Location Repository

**File**: `lib/features/locations/data/repositories/location_repository.dart`
- Line 107: Add `@override` above `getCountByProject()`
- Line 122: Add `@override` above `getCount()`
- Line 127: Add `@override` above `getPaged()`
- Line 138: Add `@override` above `getByProjectIdPaged()`

#### Project Files

**File**: `lib/features/projects/data/datasources/local/project_local_datasource.dart`
- Line 68: Add `@override` above `getCount()`

**File**: `lib/features/projects/data/repositories/project_repository.dart`
- Line 93: Add `@override` above `getCount()`
- Line 113: Add `@override` above `getPaged()`

#### Quantities Repository

**File**: `lib/features/quantities/data/repositories/entry_quantity_repository.dart`
- Line 152: Add `@override` above `getCount()`
- Line 157: Add `@override` above `getPaged()`

#### Toolbox Repositories

**File**: `lib/features/toolbox/data/repositories/form_response_repository.dart`
- Line 289: Add `@override` above `getCount()`
- Line 299: Add `@override` above `getPaged()`

**File**: `lib/features/toolbox/data/repositories/inspector_form_repository.dart`
- Line 203: Add `@override` above `getCount()`
- Line 213: Add `@override` above `getPaged()`

### 5.4: Field Override with Missing @override (1 issue)

**File**: `lib/features/pdf/presentation/widgets/import_type_dialog.dart`
- Line 79: Add `@override` above `final GlobalKey key;`

**Note**: This field overrides `Widget.key`. Consider if this is intentional or should be removed.

### Implementation Steps

1. Remove unused variables (bulk deletion)
2. Remove dead code (1 line)
3. Add `@override` annotations (bulk find-and-insert)
4. Review import_type_dialog.dart key override (may need refactoring)

### Verification

```bash
pwsh -Command "flutter analyze --no-fatal-infos | Select-String -Pattern 'unused_local_variable|unused_field|annotate_overrides|overridden_fields|dead_code'"
```

Expected: 0 issues

---

## Phase 6: Test Code Cleanup

**Priority**: LOW
**Issues**: 64 (19 await_only_futures + 20 null comparisons + 5 style + 20 test-specific)
**Agent**: `qa-testing-agent`

### Summary

Clean up test code issues that don't affect functionality but reduce noise in analyzer output.

### 6.1: await_only_futures (19 issues)

Remove `await` from calls to `.exists` (returns `bool`, not `Future<bool>`).

#### Integration Tests

**File**: `integration_test/patrol/e2e_tests/offline_sync_test.dart`
- Lines 68, 102, 166, 174, 334: Change `await $.exists` → `$.exists`

**File**: `integration_test/patrol/e2e_tests/photo_flow_test.dart`
- Lines 40, 123, 204: Change `await $.exists` → `$.exists`

**File**: `integration_test/patrol/e2e_tests/project_management_test.dart`
- Lines 141, 250, 266, 313, 323, 333, 343, 358: Change `await $.exists` → `$.exists`

**File**: `integration_test/patrol/helpers/patrol_test_helpers.dart`
- Lines 681, 719: Change `await $.exists` → `$.exists`

**Pattern**:
```dart
// WRONG:
if (await $(TestingKeys.someKey).exists) { ... }  // .exists is not async

// RIGHT:
if ($(TestingKeys.someKey).exists) { ... }
```

### 6.2: unnecessary_null_comparison (20 issues in test/ directory)

These are from null-safety migration where comparisons like `!= null` are now always true/false. Simplify the checks.

**Files**:
- `test/features/entries/presentation/screens/entry_wizard_screen_test.dart`: 5 issues
- `test/features/projects/presentation/screens/project_setup_screen_test.dart`: 8 issues
- `test/features/quantities/presentation/screens/quantities_screen_test.dart`: 2 issues
- `test/features/toolbox/presentation/screens/calculator_screen_test.dart`: 2 issues
- `test/features/toolbox/presentation/screens/gallery_screen_test.dart`: 3 issues
- `test/features/toolbox/presentation/screens/todos_screen_test.dart`: 2 issues

**Pattern**:
```dart
// WRONG:
final value = someNonNullableValue;
if (value != null) { ... }  // Always true

// RIGHT:
final value = someNonNullableValue;
// Just use value directly, no null check needed
```

**Note**: Review each instance - some may need to change type to nullable if null is valid.

### 6.3: prefer_function_declarations_over_variables (5 issues)

**File**: `test/features/toolbox/presentation/screens/calculator_screen_test.dart`
- Lines 275, 284, 293, 302, 311: Change function variables to function declarations

**Pattern**:
```dart
// WRONG:
final myFunction = () {
  // ...
};

// RIGHT:
void myFunction() {
  // ...
}
```

### 6.4: unnecessary_nullable_for_final_variable_declarations (2 issues)

**File**: `test/features/entries/presentation/screens/entry_wizard_screen_test.dart`
- Line 463: Change `final String? value = nonNullable;` → `final String value = nonNullable;`

**File**: `test/features/toolbox/presentation/screens/todos_screen_test.dart`
- Line 547: Same pattern

### 6.5: avoid_print (13 issues)

Replace `print()` with proper logging in test config files.

**File**: `integration_test/patrol/test_config.dart`
- Lines 106, 107, 109, 111: Replace with `debugPrint()` or suppress with `// ignore: avoid_print`

**File**: `lib/core/config/test_mode_config.dart`
- Lines 107, 109, 111, 115, 118: Same fix

**Pattern** (if debug logging is intentional):
```dart
// Suppress warning:
// ignore: avoid_print
print('Debug: ...');

// OR use debugPrint:
debugPrint('Debug: ...');
```

### 6.6: Other Style Issues (3 issues)

**File**: `lib/features/toolbox/presentation/widgets/weight_20_10_section.dart`
- Line 5: Rename class `Weight20_10Section` → `Weight2010Section` (UpperCamelCase)

**File**: `lib/shared/utils/validators.dart`
- Line 4: Fix dangling library doc comment (move comment inside library directive)

**File**: `test/helpers/mocks/mocks.dart`
- Line 1: Fix dangling library doc comment

**File**: `test/golden/test_helpers.dart`
- Line 127: Change constructor parameter to super parameter:
  ```dart
  // OLD:
  CustomPainter({required this.testFile});

  // NEW:
  CustomPainter({required super.testFile});
  ```

### Implementation Steps

1. Bulk replace `await $.exists` → `$.exists` (19 instances)
2. Review and simplify null comparisons (20 instances)
3. Convert function variables to declarations (5 instances)
4. Remove unnecessary nullable types (2 instances)
5. Suppress or replace print statements (13 instances)
6. Fix style issues (4 instances)

### Verification

```bash
pwsh -Command "flutter analyze --no-fatal-infos | Select-String -Pattern 'await_only_futures|unnecessary_null_comparison|prefer_function_declarations|avoid_print|camel_case_types|dangling_library_doc|use_super_parameters'"
```

Expected: 0 issues

---

## Execution Order

| Phase | Priority | Issues Fixed | Estimated Time | Agent |
|-------|----------|--------------|----------------|-------|
| **Phase 1** | CRITICAL | 7 errors | 15 min | `qa-testing-agent` |
| **Phase 2** | HIGH | 30 warnings | 15 min | `code-review-agent` |
| **Phase 3** | HIGH | 10 info/warn | 45 min | `flutter-specialist-agent` |
| **Phase 4** | MEDIUM | 15 info | 30 min | `flutter-specialist-agent` |
| **Phase 5** | MEDIUM | 33 info/warn | 20 min | `code-review-agent` |
| **Phase 6** | LOW | 64 info/warn | 30 min | `qa-testing-agent` |
| **TOTAL** | | **157 issues** | **2h 35min** | |

## Success Criteria

After all phases:

```bash
pwsh -Command "flutter analyze"
```

**Expected Output**:
```
Analyzing Field Guide App...
No issues found! (ran in X.Xs)
```

**Verification Commands**:
```bash
# No errors
pwsh -Command "flutter analyze 2>&1 | Select-String 'error -'"

# No warnings
pwsh -Command "flutter analyze 2>&1 | Select-String 'warning -'"

# Only expected info (if any remain)
pwsh -Command "flutter analyze --no-fatal-infos"
```

## Rollback Plan

If any phase introduces regressions:

1. **Revert phase commit**: `git revert <commit-sha>`
2. **Run tests**: `pwsh -Command "flutter test"`
3. **Document issue**: Add to `.claude/memory/defects.md`
4. **Re-plan**: Update this plan with alternative approach

## Notes

- **DO NOT** skip phases - dependencies may exist
- **Phase 1 MUST complete first** - blocks test execution
- **Test after each phase**: `flutter test` (unit tests should pass)
- **Commit after each phase**: Atomic commits for easy rollback
- **Suppress only if necessary**: Prefer fixing over `// ignore:` comments

## References

- Patrol v4 Migration: `.claude/plans/_state.md` (Session 234)
- Flutter Deprecations: https://docs.flutter.dev/release/breaking-changes
- Async Context Safety: `.claude/memory/defects.md` (Active Patterns)
- Code Standards: `.claude/rules/coding-standards.md`
