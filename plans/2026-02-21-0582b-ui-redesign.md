# 0582B UI Redesign Plan

**Date:** 2026-02-21
**Status:** Pending Approval
**Scope:** Complete UI/UX redesign of 0582B form system â€” three-view architecture, full form fields, efficient data flows, bug fixes.
**Supersedes:** `.claude/plans/2026-02-20-0582b-form-redesign.md` (Phases 3-6)

---

## Decisions Made

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Primary use | Phone/tablet in the field | Touch-friendly, large targets, clear hierarchy |
| Row layout | Labeled card per row, vertical stacking | Most readable, persistent labels, big touch targets |
| Input method | SmartInputBar (fixed, improved) | Bottom bar with field highlight, auto-save on switch, actual Next advancement |
| Architecture | Three-view system | Daily entry = data hub, form screen = viewer/reviewer |
| Data entry point | From daily entry, flows to form | "Send to Form" per test row; form persists across day |
| Test row groups | 3 groups: Gauge + Density + Location | Mirrors PDF columns left-to-right as sections top-to-bottom |
| Display order | Header > Tests > Proctor > 20/10 Weights | Matches paper form, familiar to inspectors |
| Row editability | Always editable | Fast corrections in the field |
| Rechecks | Simple toggle (original/recheck) | Rare occurrence, don't over-engineer |
| Chart digitization | Deferred to separate plan | Manual entry of Max Density + Optimum Moisture for V1 |

---

## Domain Reference

### MDOT 0582B Form Structure (from Density Testing Manual 2024)

**Source**: `Pre-devolopment and brainstorming/Form Templates for export/Density-Testing-Inspection-Manual.pdf`

#### Header (10 fields)
- Date, Control Section ID, Job Number, Route Number/Street, Gauge Number
- Density Inspector, Certification Number, Phone Number, Construction Eng (MDOT), Asst. Con. Eng/Consultant Eng

#### Main Table: "Determination of In-Place Density" (16 columns per test row)
| Col | Label | Source | Type |
|-----|-------|--------|------|
| 1 | Original/Recheck | Inspector marks | Toggle |
| 2 | (empty in this table, but test number) | Sequential | Auto |
| 3 | Test Depth (inch) | Inspector reads gauge | Numeric |
| 4 | Counts (MC) | Gauge display | Numeric |
| 5 | Counts (DC) | Gauge display | Numeric |
| 6 | Dry Density PCF | Gauge display | Numeric |
| 7 | Wet Density PCF | Gauge display | Numeric |
| 8 | Moisture PCF | Gauge display | Numeric |
| 9 | Moisture % | Gauge display | Numeric |
| 10 | Max Density PCF | From proctor (manual entry in V1) | Numeric |
| 11 | Percent of Compaction | Calculated OR gauge display | Calc/Numeric |
| 12 | Station | Inspector | Text |
| 13 | Distance from CL - Left (ft) | Inspector | Numeric |
| 14 | Distance from CL - Right (ft) | Inspector | Numeric |
| 15 | Depth Below Plan Grade (ft) | Inspector | Numeric |
| 16 | Item of Work | Inspector | Dropdown |

#### Second Table: "Determination of Maximum Density (Soil & HMA)" (10 columns)
| Col | Label | Source | Type |
|-----|-------|--------|------|
| A | Test Number | Sequential | Auto |
| B | Moisture % | Speedy tester or gauge | Numeric |
| C | Volume Mold (cu ft) | Painted on mold | Numeric |
| D | Wet Soil + Mold (g) | Scale reading | Numeric |
| E | Mold (g) | Painted on mold | Numeric |
| F | Wet Soil (g) | Calculated: D - E | Calc |
| G | Wet Soil (lbs) | Calculated: F / 453.59 | Calc |
| H | Compacted Soil Wet PCF | Calculated: G / C | Calc |
| I | Max Density PCF | From One-Point Chart (manual entry in V1) | Numeric |
| J | Optimum Moisture % | From One-Point Chart (manual entry in V1) | Numeric |

#### 20/10 Weights
- 5 successive gram readings (1st through 5th)
- **20/10 Rule**: After cone compaction, add material + pound 20 more times. Re-weigh. If increase <= 10g, consolidation achieved. Otherwise repeat.
- App validates: delta between consecutive readings <= 10g = pass

#### Footer
- Chart Standards: Density / Moisture (from gauge book)
- Operating Standards: Density / Moisture (daily standard count)
- Remarks (free text)
- Agency/Company

### Calculation Chain
```
PROCTOR TABLE (field-calculated):
  Wet Soil (g) = Wet Soil+Mold (g) - Mold (g)           [Col F = D - E]
  Wet Soil (lbs) = Wet Soil (g) / 453.59                 [Col G = F / 453.59]
  Compacted Wet PCF = Wet Soil (lbs) / Volume Mold       [Col H = G / C]
  Max Density = from One-Point Chart (manual V1)          [Col I]
  Optimum Moisture = from One-Point Chart (manual V1)     [Col J]

TEST ROW (per nuclear gauge test):
  Dry Density = Wet Density / (1 + Moisture% / 100)       [Existing calc]
  % Compaction = (Dry Density / Max Density) x 100        [Existing calc]

20/10 VALIDATION:
  For each consecutive pair: abs(reading[n] - reading[n-1]) <= 10g = pass
```

---

## Three-View Architecture

### View 1: Daily Entry â€” Forms Section

A new section on the daily entry screen showing linked forms.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FORMS                                       â”‚  titleMedium
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MDOT 0582B                             â”‚ â”‚  Card (surfaceElevated)
â”‚  â”‚  3 tests Â· Open                         â”‚ â”‚  radiusMedium (12)
â”‚  â”‚  Last: Sta 12+50 Â· 89.01%              â”‚ â”‚
â”‚  â”‚  [+ New Test]           [View Form â†’]   â”‚ â”‚  48dp buttons
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  MDOT 1174R                             â”‚ â”‚
â”‚  â”‚  0 tests Â· Open                         â”‚ â”‚
â”‚  â”‚  [+ New Test]           [View Form â†’]   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Widget**: `EntryFormCard` â€” shows form type, test count, status, last test summary, action buttons.

### View 2: Quick Test Entry Screen

Opens from "+ New Test" on daily entry. Primary data entry surface for a single test row. Three groups matching the PDF table columns.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back     NEW TEST â†’ 0582B         #4    â”‚  AppBar
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â”Œâ”€ GAUGE READINGS â”€â”€â”€ primaryCyan â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Original â—‹ / Recheck â—‹                  â”‚â”‚
â”‚  â”‚  Test Depth        [      ] in           â”‚â”‚  56dp input
â”‚  â”‚  Counts (MC)  [      ]  Counts (DC) [  ] â”‚â”‚  side-by-side
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€ DENSITY RESULTS â”€â”€ statusInfo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Dry Density  [      ] pcf   Wet Density [      ] pcf  â”‚â”‚
â”‚  â”‚  Moisture PCF = ___   pcf   Moisture     [      ] %    â”‚â”‚  calc italic
â”‚  â”‚  Max Density  [      ] pcf   % Compaction = ___  %     â”‚â”‚  calc italic
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€ LOCATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ accentAmber â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Station           [              ]      â”‚â”‚
â”‚  â”‚  Dist. from CL     L [    ]  R [    ] ft â”‚â”‚
â”‚  â”‚  Depth Below Grade [      ] ft           â”‚â”‚
â”‚  â”‚  Item of Work      [          ] â–¼        â”‚â”‚  dropdown
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚         âœ“  SEND TO FORM                  â”‚â”‚  ElevatedButton
â”‚  â”‚            primaryCyan, 56dp             â”‚â”‚  full width
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**SmartInputBar** (slides up when field tapped):
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Wet Density (PCF)                          â”‚  labelLarge
â”‚  [  135.2               ]  [â—€] [â–¶]  [Done] â”‚  48dp nav buttons
â”‚                     elevation: 8            â”‚  surfaceElevated
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key behaviors:**
- `onFieldSwitch`: commits current value BEFORE switching (fixes BUG-1)
- `onNext`: saves value + advances to next editable field (fixes BUG-2)
- `onDone`: saves value + dismisses bar (fixes BUG-3)
- Calculated fields show `â‰ˆ` prefix, italic text, surfaceHighlight bg
- Active field: primaryCyan 2px border highlight (fixes UX-2)
- Human-readable labels ("Wet Density" not "wet_density") (fixes UX-1)

### View 3: Form Viewer Screen

Opens from "View Form â†’" on daily entry. PDF-like review/edit view.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back    MDOT 0582B    [ðŸ‘ PDF] [ðŸ’¾] [ðŸ“¤]â”‚  AppBar
â”‚            â— Open Â· 3 tests                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              â”‚
â”‚  â”Œâ”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Date             02/20/2026     (auto)  â”‚â”‚
â”‚  â”‚  Control Section  CS 12345       (auto)  â”‚â”‚
â”‚  â”‚  Job Number       864130         (auto)  â”‚â”‚
â”‚  â”‚  Route/Street     M-37           (auto)  â”‚â”‚
â”‚  â”‚  Gauge Number     T-3440-1234            â”‚â”‚
â”‚  â”‚  Inspector        John Smith     (auto)  â”‚â”‚
â”‚  â”‚  Cert. Number     MI-1234        (auto)  â”‚â”‚
â”‚  â”‚  Phone            517-555-0100   (auto)  â”‚â”‚
â”‚  â”‚  Const. Eng.      Jane Doe       (auto)  â”‚â”‚
â”‚  â”‚  Asst. Eng.       [            ]         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”€â”€ IN-PLACE DENSITY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”€â”‚
â”‚  â”Œ TEST #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âœ“ Sent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Gauge: 6in Â· MC 2450 Â· DC 1820         â”‚â”‚  compact view
â”‚  â”‚  Dry 115.8  Wet 135.2  Moist 19.4 pcf   â”‚â”‚
â”‚  â”‚  Max 140.0  Comp 89.01%    M% 8.5       â”‚â”‚
â”‚  â”‚  Loc: 12+50  L 5ft  Grade 2ft  HMA      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œ TEST #2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ âœ“ Sent â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ...                                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”€â”€ MAX DENSITY (PROCTOR) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”‚
â”‚  â”Œ PROCTOR #1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Moist 17.3%  Vol 0.0333 cuft            â”‚â”‚
â”‚  â”‚  Soil+Mold 3810g  Mold 1640g            â”‚â”‚
â”‚  â”‚  Wet Soil 2170g â†’ 4.78 lbs              â”‚â”‚  calc chain
â”‚  â”‚  Wet PCF 143.6  Max 103.4  Opt 19.6%    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”€â”€ 20/10 WEIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  1st: 3810g  2nd: 3818g  âœ“ Î”8g â‰¤ 10g   â”‚â”‚  statusSuccess
â”‚  â”‚  3rd: â€”â€”     4th: â€”â€”     5th: â€”â€”         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”€â”€ STANDARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Chart:  Dens [    ]  Moist [    ]       â”‚â”‚
â”‚  â”‚  Oper:   Dens [    ]  Moist [    ]       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                              â”‚
â”‚  â”€â”€ REMARKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”€â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  [                                   ]   â”‚â”‚  multi-line
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**All test rows always editable** â€” tap any field to change it. Recalculations trigger live.

---

## Data Model

### FormResponse.responseData JSON Schema

```json
{
  "test_rows": [
    {
      "test_number": 1,
      "is_recheck": false,
      "test_depth_in": "6",
      "counts_mc": "2450",
      "counts_dc": "1820",
      "dry_density_pcf": "115.8",
      "wet_density_pcf": "135.2",
      "moisture_pcf": "19.4",
      "moisture_percent": "8.5",
      "max_density_pcf": "140.0",
      "percent_compaction": "89.01",
      "station": "12+50",
      "distance_left_ft": "5",
      "distance_right_ft": "",
      "depth_below_grade_ft": "2",
      "item_of_work": "HMA"
    }
  ],
  "proctor_rows": [
    {
      "test_number": 1,
      "moisture_percent": "17.3",
      "volume_mold_cuft": "0.0333",
      "wet_soil_mold_g": "3810",
      "mold_g": "1640",
      "wet_soil_g": "2170",
      "wet_soil_lbs": "4.78",
      "compacted_wet_pcf": "143.6",
      "max_density_pcf": "103.4",
      "optimum_moisture_pct": "19.6"
    }
  ],
  "weights_20_10": ["3810", "3818", "", "", ""],
  "chart_standards": { "density": "", "moisture": "" },
  "operating_standards": { "density": "", "moisture": "" },
  "remarks": ""
}
```

### FormResponse.headerData JSON Schema

```json
{
  "date": "2026-02-20",
  "control_section_id": "CS 12345",
  "job_number": "864130",
  "route_street": "M-37",
  "gauge_number": "T-3440-1234",
  "inspector": "John Smith",
  "cert_number": "MI-1234",
  "phone": "517-555-0100",
  "construction_eng": "Jane Doe",
  "asst_eng": ""
}
```

### Auto-Fill Sources

| Field | Source | New Field? |
|-------|--------|------------|
| Date | `DateTime.now()` | No |
| Job Number | `project.projectNumber` | No |
| Control Section ID | `project.controlSectionId` | Yes â€” add to Project model |
| Route/Street | `project.routeStreet` | Yes â€” add to Project model |
| Inspector | `PreferencesService.inspectorName` | No |
| Cert. Number | `PreferencesService.certNumber` | Yes â€” add to prefs |
| Phone | `PreferencesService.phone` | Yes â€” add to prefs |
| Construction Eng. | `project.constructionEng` | Yes â€” add to Project model |
| Gauge Number | `PreferencesService.gaugeNumber` | Yes â€” add to prefs |

### "Send to Form" Flow

```
Inspector taps "Send to Form" on Quick Test Entry
  â”‚
  â”œâ”€â”€ Validate: minimum Wet Density + Max Density present
  â”œâ”€â”€ Run calculations (Dry Density, Moisture PCF, % Compaction)
  â”œâ”€â”€ Assign test_number = next sequential
  â”œâ”€â”€ Append row to FormResponse.test_rows
  â”œâ”€â”€ Save FormResponse to SQLite
  â”œâ”€â”€ Invalidate preview (hasPreviewedInSession = false)
  â”œâ”€â”€ Show snackbar: "Test #4 sent to 0582B âœ“"
  â””â”€â”€ Return to daily entry (form card updates count)
```

---

## Bug Fixes (Folded Into Architecture)

| Bug | Root Cause | Fix |
|-----|-----------|-----|
| BUG-1: Value lost on cell switch | No commit before switch | SmartInputBar `onFieldSwitch` calls `_commitCurrentValue()` first |
| BUG-2: Next doesn't advance | `_applySmartInput` never updates active field index | Ordered field list; `onNext` saves + advances index past calc fields |
| BUG-3: Done unresponsive | State race on widget rebuild | Commit then dismiss in `Future.microtask`; stable ValueKeys |
| BUG-4: PDF template missing | Wrong asset path | Fix to `assets/templates/forms/mdot_0582b_form.pdf` (exists); implement field-filling |
| BUG-5: No saved form list | Forms list only shows "New" | "View Form" on daily entry card; also add forms list to Toolbox |

## UX Fixes (Folded Into Architecture)

| Issue | Fix |
|-------|-----|
| UX-1: Raw field keys | Human-readable labels in SmartInputBar + all sections |
| UX-2: No selected cell highlight | Active field gets primaryCyan 2px border |
| UX-3: Calc vs editable look same | Calc fields: surfaceHighlight bg, italic, "â‰ˆ" prefix |
| UX-4: No row numbers | "TEST #N" header on every card |
| UX-5: Labels disappear | Persistent labels â€” label stays left, value right |
| UX-6: Not field-ready | Full redesign with section grouping, accent colors, 56dp inputs |

---

## Design Tokens Used

| Element | Token | Value |
|---------|-------|-------|
| Section accent (Gauge) | `primaryCyan` | #00BCD4 |
| Section accent (Density) | `statusInfo` | #2196F3 |
| Section accent (Location) | `accentAmber` | #FFC107 |
| Card background | `surfaceElevated` | dark: #1E1E2E |
| Calculated field bg | `surfaceHighlight` | dark: #2A2A3E |
| Active field border | `primaryCyan` | 2px, matches focusedBorder |
| Input height | `touchTargetComfortable` | 56dp |
| Button min height | `touchTargetMin` | 48dp |
| Card radius | `radiusMedium` | 12 |
| Spacing between sections | `space8` | 24 |
| Spacing within sections | `space4` | 8 |
| Status badge (sent) | `statusSuccess` | #4CAF50 |
| Auto-fill indicator | `textTertiary` | "(auto)" suffix |
| Calculated text | `textSecondary` + italic | "â‰ˆ" prefix |

---

## Implementation Phases

### Phase 1: Data Model Expansion
**Goal**: Full data foundation for all form sections.

**Build**:
- Expand `Mdot0582BCalculator` â€” add proctor calcs (F=D-E, G=F/453.59, H=G/C), 20/10 validation (delta <= 10g)
- Expand `FormResponse` JSON schema to match above
- Add new `PreferencesService` fields: certNumber, phone, gaugeNumber
- Add new `Project` model fields: controlSectionId, routeStreet, constructionEng
- Update `AutoFillService` to fill all 10 header fields
- DB migration for new Project columns

**Verify**: Unit tests for all calculator formulas, proctor chain, 20/10 validation.

**Agent**: `backend-data-layer-agent`

---

### Phase 2: Quick Test Entry Screen
**Goal**: The primary data entry surface from daily entry.

**Build**:
- New `QuickTestEntryScreen` â€” three-group layout (Gauge, Density, Location)
- New `FormSectionCard` â€” reusable section wrapper with accent color line + title
- Updated `SmartInputBar` â€” fix BUG-1 (auto-commit), BUG-2 (next advancement), BUG-3 (done stability)
- Updated `FormFieldCell` â€” persistent label + value, active highlight
- Updated `CalculatedFieldCell` â€” surfaceHighlight bg, italic, "â‰ˆ" prefix
- "Send to Form" action with validation, calculation, row append
- Route registration + navigation from daily entry

**Verify**: dart-mcp â€” open from daily entry, fill all three groups, verify calcs, send to form, confirm snackbar.

**Agent**: `frontend-flutter-specialist-agent` + `interface-design` skill

---

### Phase 3: Form Viewer Screen
**Goal**: PDF-like review/edit view with all sections.

**Build**:
- Rewrite `FormFillScreen` â†’ `FormViewerScreen`
- New section widgets: `FormHeaderViewer`, `TestRowCard`, `ProctorSection`, `WeightsSection`, `StandardsSection`, `RemarksSection`
- All rows always editable (tap any field)
- Live recalculation on edit
- Status badges on test rows (âœ“ Sent)
- Preview PDF / Save / Export buttons in AppBar

**Verify**: dart-mcp â€” view form with 3 tests, all data displays, edit inline, verify recalc.

**Agent**: `frontend-flutter-specialist-agent` + `interface-design` skill

---

### Phase 4: Daily Entry Integration
**Goal**: Forms section on daily entry + "Send to Form" flow.

**Build**:
- New `EntryFormCard` widget â€” form type, test count, status, last test summary
- New Forms section on daily entry screen (below existing sections)
- Wire "+ New Test" â†’ Quick Test Entry Screen
- Wire "View Form â†’" â†’ Form Viewer Screen
- "Send to Form" writes row to FormResponse, navigates back, card updates

**Verify**: dart-mcp â€” daily entry shows form cards, new test â†’ enter â†’ send â†’ count updates.

**Agent**: `frontend-flutter-specialist-agent`

---

### Phase 5: PDF + Polish
**Goal**: Working PDF preview/export and remaining polish.

**Build**:
- Fix PDF template path â†’ `assets/templates/forms/mdot_0582b_form.pdf`
- Implement PDF field-filling with all 16 test columns + proctor + 20/10 + header
- Add saved forms list to Toolbox screen (all responses with date/inspector/status)
- Unsaved changes prompt on form viewer navigate-away
- Required fields validation on export
- Status transitions (open â†’ submitted â†’ exported)

**Verify**: Generate PDF preview, verify all fields populate. Full E2E flow test.

**Agent**: `pdf-agent` + `qa-testing-agent`

---

## Agent Assignments

| Phase | Primary Agent | Support |
|-------|--------------|---------|
| Phase 1: Data Model | backend-data-layer-agent | â€” |
| Phase 2: Quick Test Entry | frontend-flutter-specialist-agent | interface-design skill |
| Phase 3: Form Viewer | frontend-flutter-specialist-agent | interface-design skill |
| Phase 4: Daily Entry Integration | frontend-flutter-specialist-agent | â€” |
| Phase 5: PDF + Polish | pdf-agent | qa-testing-agent |

---

## Future Work (Not in This Plan)

- **One-Point Chart Digitization**: Digitize the T-99 and Michigan Cone charts into programmatic lookup functions. Separate brainstorm + plan.
- **1174R Form**: Apply same three-view architecture to concrete form.
- **Form Templates**: Support for additional MDOT forms beyond 0582B/1174R.
- **Proctor Data Carry-Forward**: When soil type doesn't change, carry forward proctor values from previous form.
- **Gauge Bluetooth Integration**: Read values directly from Troxler 3440 / InstroTek 3500 via Bluetooth.

---

## Reference Documents

- MDOT Density Testing and Inspection Manual 2024: `Pre-devolopment and brainstorming/Form Templates for export/Density-Testing-Inspection-Manual.pdf`
- MDOT Form 0582B: `assets/templates/forms/mdot_0582b_form.pdf`
- One-Point Michigan Cone Chart: Manual page 27 (Figure 18)
- One-Point T-99 Chart: Manual page 19 (Figure 16, referenced but not shown in pages read)
- Previous plan: `.claude/plans/2026-02-20-0582b-form-redesign.md`
- Test findings: `.claude/test-results/2026-02-21-0582b-form-testing-findings.md`
